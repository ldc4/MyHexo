title: Linux下如何进程调度
date: 2016-05-07 14:41:21
categories:
- Linux
tags:
- linux
- schedule
---

当遇到这个面试题，我内心是崩溃的。
好吧，还是得去看，先看了《现代操作系统》的调度那一小节。
看完后发现，与问题风马牛不相及啊。
然后，翻到后面的Linux进程调度，继续看，不是太好理解，可能是翻译的书都这样。
后面找到一个文章写得不错。
最后，怕忘，觉得还是写个博文总结一下比较好。

<!--more-->

先来看看基础知识：

## 进程的调度

>不同的环境需要不同的调度算法

三种环境：
- 批处理
- 交互式
- 实时


1.批处理系统中的调度
	
	a.先来先服务
	b.最短作业优先
	c.最短剩余时间优先

2.交互式系统中的调度

	a.轮转调度
	b.优先级调度
	c.多级队列
	d.最短进程优先
	e.保证调度
	f.彩票调度
	d.公平分享调度


## Linux下的进程调度

>最基本的手段：优先级


### 如何确定优先级？
由用户程序指定、由内核调度程序动态调整


### 如何调度？
Linux内核将进程分成两个级别：普通进程和实时进程。
实时进程的优先级都高于普通线程，除此之外，它们的调度策略也有所不同。

#### 实时进程的调度

1.如果有一个进程有实时需求，则只要它是可执行状态的，内核就一直让它执行，以尽可能地满足它对CPU的需要，直到它完成所有需要做的事情，然后睡眠或退出
2.如果有多个实时进程都处于可自行状态， 内核先满足优先级最高的实时进程对CPU的需要，直到它变为非可自行状态
3.如果多个相同优先级的实时进程都处于可执行状态，这时就有两种调度策略可供选择：先进先出，轮转调度

#### 普通进程的调度

1.动态调整进程的优先级

交互式进程和批处理进程

调度程序关注进程近一段时间内的表现（主要是检查其睡眠时间和运行时间），根据一些经验性的公式，判断它现在是交互式的还是批处理的？程度如何？最后决定给它的优先级做一定的调整。
进程的优先级被动态调整后，就出现了两个优先级：
a.用户程序设置的优先级（如果未设置，则使用默认值），称为静态优先级。这是进程优先级的基准，在进程执行的过程中往往是不改变的；
b.优先级动态调整后，实际生效的优先级。这个值是可能时时刻刻都在变化的；

2.调度的公平性

Linux实现公平调度基本上是两种思路：
a.给处于可执行状态的进程分配时间片（按照优先级），**用完时间片的进程被放到“过期队列”中**。等可执行状态的进程都过期了，再重新分配时间片；
b.动态调整进程的优先级。**随着进程在CPU上运行，其优先级被不断调低**，以便其他优先级较低的进程得到运行机会；

后一种方式有更小的调度粒度，并且将“公平性”与“动态调整优先级”两件事情合而为一，大大简化了内核调度程序的代码。因此，这种方式也成为内核调度程序的新宠。

## 疑问

《现代操作系统》写到：
>Linux系统的线程是内核线程，所以Linux系统的调度是基于线程的，而不是基于进程的。

那调度的到底是进程还是内核线程？

## 总结

那么回到最初，如何回答标题这个问题呢？

Linux进程调度是将优先级调度、时间片轮转法调度、先进先出调度综合起来应用的，这三类调度策略均基于优先级。
Linux内核将进程分为实时进程和普通进程。普通进程的优先级低于实时进程。
实时进程采用先进先出和轮转调度两种调度策略。其优先级由用户指定，因为内核不知道进程是不是实时，以及有多实时。
普通进程又分为交互式进程和批处理进程，交互式的优先级一般比批处理优先级高，调度程序关注进程近一段时间内的表现，会给它的优先级进行调整。
Linux内核对于普通进程说还要考虑调度的公平性，实现有两种思路：第一种，给处于可执行状态的进程分配时间片（按照优先级），用完时间片的进程被放到“过期队列”中。等可执行状态的进程都过期了，再重新分配时间片；第二种，动态调整进程的优先级。随着进程在CPU上运行，其优先级被不断调低，以便其他优先级较低的进程得到运行机会；


参考资料：
https://yq.aliyun.com/articles/8900

我博文写得很随意，因为这些都不是我自己创造的内容，尽量以简要的形势列出重点。如有疑惑，请前往参考资料查阅。